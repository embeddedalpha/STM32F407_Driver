/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 */

#include <stdint.h>
#include "main.h"
#include "Console.h"



float v_sense = 0;
float temp = 0;
const float V25 = 0.76;
const float Avg_Slope = 2.5;

int main(void)
{
	MCU_Clock_Setup();
	Delay_Config();
	Console_Init(USART1, 460800);


	RCC -> APB2ENR |= RCC_APB2ENR_ADC1EN;
	ADC1 -> CR2 |= ADC_CR2_ADON | ADC_CR2_CONT ;
	ADC123_COMMON -> CCR |= ADC_CCR_TSVREFE;
	ADC1 -> SMPR1 |= ADC_SMPR1_SMP18;
	ADC1 -> CR2 |= ADC_CR2_SWSTART;


	for(;;)
	{
		v_sense = ((ADC1 -> DR) * 3.3)/4095;
		temp = ((v_sense - V25) / Avg_Slope)+25;
		printConsole(USART1, "%f\r\n",temp);
//		printConsole(USART1, "%f\r\n",v_sense);
		Delay_ms(100);

	}
}
